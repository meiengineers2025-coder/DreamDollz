<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DreamDollz â€” Beta 11</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/OrbitControls.min.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: linear-gradient(to bottom, #ffe4f0, #e6e6fa);
  font-family: 'Poppins', sans-serif;
  overflow: hidden;
}
canvas {
  display: block;
  width: 100%;
  height: 70vh;
  border: 3px solid #ff69b4;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(255,105,180,0.6);
}
#overlay {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(255,255,255,0.95);
  z-index: 10;
}
#box {
  text-align: center;
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 320px;
}
input {
  width: 90%;
  padding: 12px;
  margin: 10px 0;
  border: 2px solid #ff69b4;
  border-radius: 8px;
  font-size: 16px;
}
button {
  background: #ff69b4;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 18px;
  margin: 4px;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
}
button:hover { background: #da70d6; }
#controls {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
  display: none;
  z-index: 5;
}
.row { display: flex; justify-content: center; margin: 6px 0; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="overlay">
  <div id="box">
    <h2 style="color:#4b0082;">DreamDollz</h2>
    <p>Enter your star's name:</p>
    <input id="name" placeholder="Barbie" maxlength="15">
    <br>
    <button id="startBtn">Start</button>
  </div>
</div>

<div id="controls">
  <div class="row">
    <button onclick="setHair('blonde')">Blonde</button>
    <button onclick="setHair('brown')">Brown</button>
    <button onclick="setHair('red')">Red</button>
  </div>
  <div class="row">
    <button onclick="setDress('pink')">Pink</button>
    <button onclick="setDress('blue')">Blue</button>
    <button onclick="setDress('green')">Green</button>
  </div>
  <div class="row">
    <button onclick="setShoes('heels')">Heels</button>
    <button onclick="setShoes('boots')">Boots</button>
    <button onclick="setShoes('sneakers')">Sneakers</button>
  </div>
  <div class="row">
    <button onclick="addHat()">Hat</button>
    <button onclick="removeHat()">No Hat</button>
    <button id="resetBtn">Reset</button>
  </div>
  <div class="row">
    <button id="waveBtn">Wave</button>
    <button id="danceBtn">Dance</button>
  </div>
</div>

<script>
// THREE and OrbitControls are now available globally.
let scene, camera, renderer, controls, doll, clock, pose = null;
let hairColor = 0xffe680, dressColor = 0xff69b4, hasHat = false, shoeType = 'heels'; 

function init() {
  scene = new THREE.Scene();
  // Ensure we are using the globally available THREE object
  camera = new THREE.PerspectiveCamera(45, window.innerWidth / (window.innerHeight * 0.7), 0.1, 100);
  camera.position.set(0, 1.5, 3);

  renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('c'), antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight * 0.7);
  renderer.setClearColor(0x000000, 0);

  // CRUCIAL FIX: Explicitly use THREE.OrbitControls with old CDN
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.target.set(0, 1.1, 0);
  controls.enableDamping = true;

  scene.add(new THREE.DirectionalLight(0xffffff, 1.5).position.set(5, 10, 5));
  scene.add(new THREE.AmbientLight(0xffffff, 1.0));

  clock = new THREE.Clock();
  createDoll();
  animate();
}

function createDoll() {
  if (doll) scene.remove(doll);
  doll = new THREE.Group();

  const skin = new THREE.MeshStandardMaterial({ color: 0xffd8c6 });
  const dress = new THREE.MeshStandardMaterial({ color: dressColor });
  const hairMat = new THREE.MeshStandardMaterial({ color: hairColor });

  // Body
  const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.7, 8, 16), dress);
  body.position.y = 1.0;
  doll.add(body);

  // Head
  const head = new THREE.Mesh(new THREE.SphereGeometry(0.35, 32, 32), skin);
  head.position.y = 1.65;
  doll.add(head);

  // Hair
  const hair = new THREE.Mesh(new THREE.SphereGeometry(0.38, 32, 32, 0, Math.PI*2, 0, Math.PI/1.6), hairMat);
  hair.rotation.x = -Math.PI/2;
  hair.position.y = 0.05;
  head.add(hair);

  // Arms
  const armGeo = new THREE.CylinderGeometry(0.05, 0.05, 0.5, 8);
  const leftArm = new THREE.Mesh(armGeo, skin);
  leftArm.position.set(-0.35, 1.2, 0);
  leftArm.rotation.z = Math.PI/6;
  doll.add(leftArm);
  const rightArm = leftArm.clone();
  rightArm.position.x = 0.35;
  rightArm.rotation.z = -Math.PI/6;
  doll.add(rightArm);

  // --- LEGS & SHOES LOGIC ---
  let legYOffset = 0.4;
  let footGeo, footMat;

  if (shoeType === 'heels') {
    footGeo = new THREE.BoxGeometry(0.18, 0.15, 0.35); 
    footMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
    legYOffset = 0.45; 
  } else if (shoeType === 'boots') {
    footGeo = new THREE.BoxGeometry(0.22, 0.25, 0.3); 
    footMat = new THREE.MeshStandardMaterial({ color: 0x663399 });
    legYOffset = 0.5; 
  } else { // 'sneakers'
    footGeo = new THREE.BoxGeometry(0.18, 0.1, 0.3); 
    footMat = new THREE.MeshStandardMaterial({ color: 0xcccccc });
    legYOffset = 0.4; 
  }

  // Legs
  const legGeo = new THREE.CylinderGeometry(0.07, 0.07, 0.6, 12);
  const leftLeg = new THREE.Mesh(legGeo, skin);
  leftLeg.position.set(-0.12, legYOffset, 0);
  doll.add(leftLeg);
  const rightLeg = leftLeg.clone();
  rightLeg.position.x = 0.12;
  doll.add(rightLeg);

  // Feet/Shoes
  const leftFoot = new THREE.Mesh(footGeo, footMat);
  leftFoot.position.set(-0.12, legYOffset - 0.25, 0.1); 
  doll.add(leftFoot);
  const rightFoot = leftFoot.clone();
  rightFoot.position.x = 0.12;
  doll.add(rightFoot);
  // ------------------------------------------------------------------

  // Hat
  if (hasHat) {
    const hat = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.3, 0.15, 8), new THREE.MeshStandardMaterial({ color: 0xffd700 }));
    hat.position.y = 1.9;
    head.add(hat);
  }

  scene.add(doll);
}

function setHair(color) {
  hairColor = color === 'blonde' ? 0xffe680 : color === 'brown' ? 0x8b4513 : 0xff4500;
  createDoll();
}
function setDress(color) {
  dressColor = color === 'pink' ? 0xff69b4 : color === 'blue' ? 0x4169e1 : 0x90ee90;
  createDoll();
}
function setShoes(type) { 
  shoeType = type;
  createDoll(); 
}
function addHat() { hasHat = true; createDoll(); }
function removeHat() { hasHat = false; createDoll(); }

function animate() {
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();

  if (pose === 'wave') doll.rotation.y = Math.sin(t * 2) * 0.15;
  if (pose === 'dance') {
    doll.position.y = 0.05 * Math.sin(t * 6);
    doll.rotation.y += 0.02;
  }

  controls.update();
  renderer.render(scene, camera);
}

document.getElementById('startBtn').onclick = () => {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('controls').style.display = 'block';
};

document.getElementById('waveBtn').onclick = () => pose = 'wave';
document.getElementById('danceBtn').onclick = () => pose = 'dance';
document.getElementById('resetBtn').onclick = () => {
  pose = null;
  doll.rotation.set(0, 0, 0);
  doll.position.y = 0;
  hasHat = false;
  shoeType = 'heels'; // Also reset shoes
  createDoll();
};

// CRUCIAL FIX: Wait for the entire page (and canvas) to load before calling init()
window.addEventListener('load', init); 

</script>

</body>
</html>
